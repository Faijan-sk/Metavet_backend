# ===============================================================================
# APPLICATION PROPERTIES - FIXED CONFIGURATION
# ===============================================================================

# ------------------------------
# Server Configuration
# -----------------------------
#server.port=8010

server.port=8080
# server.servlet.context-path=/api/v1/
#asdsd
# ------------------------------
# PostgreSQL Database Configuration
# ------------------------------
#spring.datasource.url=jdbc:postgresql://localhost:5432/metavet
#spring.datasource.username=postgres
#spring.datasource.password=Faizan@123
#spring.datasource.driver-class-name=org.postgresql.Driver

spring.datasource.url=jdbc:postgresql://localhost:5432/metavet_db
spring.datasource.username=metavet_user
spring.datasource.password=metavet@123
spring.datasource.driver-class-name=org.postgresql.Driver

# lowered pool sizes to avoid exhausting Postgres max_connections
spring.datasource.hikari.maximum-pool-size=6
spring.datasource.hikari.minimum-idle=1
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.max-lifetime=1800000
# enable leak detection to help find connection leaks (milliseconds)
spring.datasource.hikari.leak-detection-threshold=2000

# ------------------------------
# Hibernate / JPA Configuration
# ------------------------------
# changed from update to validate to avoid DDL work at startup which can create extra DB connections
spring.jpa.hibernate.ddl-auto=update
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.show-sql=false


spring.jpa.properties.hibernate.jdbc.batch_size=25
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.batch_versioned_data=true

# ------------------------------
# Security Configuration - 403 FIX
# ------------------------------
spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.security.servlet.SecurityAutoConfiguration
spring.security.enabled=false
management.security.enabled=false
spring.security.csrf.enabled=false

# ------------------------------
# CORS Configuration - FIXED
# ------------------------------
#spring.web.cors.allowed-origins=http://localhost:3000,http://localhost:4200,http://127.0.0.1:3000,http://127.0.0.1:4200,*
#spring.web.cors.allowed-methods=GET,POST,PUT,DELETE,OPTIONS,PATCH
#spring.web.cors.allowed-headers=Authorization,Content-Type,Accept,Origin,Access-Control-Request-Method,Access-Control-Request-Headers
#spring.web.cors.exposed-headers=Access-Control-Allow-Origin,Access-Control-Allow-Credentials
#spring.web.cors.allow-credentials=true
#spring.web.cors.max-age=3600

# ------------------------------
# CORS Configuration - FIXED
# ------------------------------
spring.web.cors.allowed-origins=http://34.61.254.251
spring.web.cors.allowed-methods=GET,POST,PUT,DELETE,OPTIONS,PATCH
spring.web.cors.allowed-headers=Authorization,Content-Type,Accept,Origin,Access-Control-Request-Method,Access-Control-Request-Headers
spring.web.cors.exposed-headers=Access-Control-Allow-Origin,Access-Control-Allow-Credentials
spring.web.cors.allow-credentials=true
spring.web.cors.max-age=3600
# ------------------------------
# Logging Configuration - Enhanced for Debugging
# ------------------------------	
logging.level.root=INFO
logging.level.org.hibernate.SQL=ERROR
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=ERROR
logging.level.org.springframework.security=DEBUG
logging.level.org.springframework.web=DEBUG
logging.level.org.springframework.web.cors=DEBUG
logging.level.com.example.demo=DEBUG
# logging.file.name=logs/metavet-app.log
# logging.file.max-size=10MB
# logging.file.max-history=30

# ------------------------------
# Jackson JSON Configuration
# ------------------------------
spring.jackson.deserialization.fail-on-unknown-properties=false
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.time-zone=Asia/Kolkata
spring.jackson.serialization.fail-on-empty-beans=false

# ------------------------------
# JWT Security Configuration - For Future Use
# ------------------------------
security.jwt.secret-key=bXlBY2Nlc3NTZWNyZXRLZXlGb3JKV1RUb2tlbkdlbmVyYXRpb25BbmRWYWxpZGF0aW9uMjAyNA==
security.jwt.refresh-secret-key=bXlSZWZyZXNoU2VjcmV0S2V5Rm9yUmVmcmVzaFRva2VuR2VuZXJhdGlvbjIwMjQ=
security.jwt.expiration-time=86400000
security.jwt.refresh.expiration-time=604800000
# security.jwt.issuer=metavet-app
# security.jwt.audience=metavet-users
# HTTP Response Headers Fix
server.error.whitelabel.enabled=false
server.error.include-stacktrace=never
server.error.include-message=always

# ------------------------------
# Email Configuration (if you plan to send emails)
# ------------------------------
# spring.mail.host=smtp.gmail.com
# spring.mail.port=587
# spring.mail.username=your-email@gmail.com
# spring.mail.password=your-app-password
# spring.mail.properties.mail.smtp.auth=true
# spring.mail.properties.mail.smtp.starttls.enable=true

# ------------------------------
# File Upload Configuration
# ------------------------------
spring.servlet.multipart.max-file-size=50MB
spring.servlet.multipart.max-request-size=50MB

# ------------------------------
# Application Specific Configuration
# ------------------------------
app.otp.expiry-minutes=5
app.otp.length=6
app.pagination.default-page-size=20
app.pagination.max-page-size=100
# app.rate-limit.requests-per-minute=100

# ------------------------------
# Production Security Headers - DISABLED for now
# ------------------------------
server.servlet.session.cookie.http-only=false
server.servlet.session.cookie.secure=false
server.servlet.session.cookie.same-site=none

# ------------------------------
# Health Check Configuration
# ------------------------------
management.endpoints.web.exposure.include=health,info,metrics
management.endpoint.health.show-details=when-authorized

# ------------------------------
# HTTP Configuration - FIXED
# ------------------------------
spring.mvc.dispatch-options-request=true
# FIXED: ant_path_matcher is deprecated, use path_pattern_parser (default) or remove this line
# spring.mvc.pathmatch.matching-strategy=ant_path_matcher

# ------------------------------
# Error Handling Configuration - FIXED
# ------------------------------
#server.error.include-message=always
server.error.include-binding-errors=always
# FIXED: on_trace_param is deprecated, use 'on-param' or 'always' or 'never'
#server.error.include-stacktrace=on-param
server.error.include-exception=false

# ------------------------------
# Environment Specific Overrides
# ------------------------------
spring.profiles.active=dev
	
# ------------------------------
# FIXES APPLIED:
# ------------------------------
# 1. Removed deprecated ant_path_matcher (Spring Boot 2.6+)
# 2. Changed on_trace_param to on-param
# 3. Spring Boot now uses path_pattern_parser by default (better performance)
# 4. These changes are compatible with Spring Boot 2.6+ and 3.x
#
# ADDITIONAL NOTES:
# ------------------------------
# If you still need ant path matcher for legacy reasons, add:
# spring.mvc.pathmatch.matching-strategy=ant-path-matcher
# 
# For stacktrace options:
# - never: Never include stacktrace
# - always: Always include stacktrace  
# - on-param: Include when 'trace' parameter is present
# - on-trace-param: (deprecated, use on-param)

# Devtools / local development tweaks
# Disable devtools automatic restart when troubleshooting connection exhaustion (uncomment if needed)
spring.devtools.restart.enabled=false
spring.jpa.properties.hibernate.jdbc.lob.non_contextual_creation=true
